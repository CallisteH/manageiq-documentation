[[installing-cloudforms]]
== Installing {product-title}

{product-title} is able to be installed and ready to configure in a few quick steps. After downloading {product-title} as a virtual machine image template from the Red Hat Customer Portal, the installation process takes you through the steps of uploading the appliance to a Red Hat Virtualization (RHV) environment.

[IMPORTANT]
=====
After installing the {product-title} appliance, you must configure the database for {product-title}. See xref:configuring_a_database[].
=====

ifdef::miq[]
[[obtaining-the-appliance]]
=== Obtaining the appliance

The following procedure outlines how to obtain a copy of the appliance from the ManageIQ homepage.

. In a browser, navigate to link:manageiq.org/download[].
. Select *Red Hat Virtualization* from the *--Choose your platform--* list.
. Select *Stable* from the *--Choose a release--* list.
. Follow the instructions to download the appliance.
endif::miq[]

ifdef::cfme[]
[[obtaining-the-appliance]]
=== Obtaining the Appliance

The following procedure outlines how to obtain a copy of the appliance from the Customer Portal.

. Log in to the Red Hat Customer Portal at link:https://access.redhat.com[access.redhat.com] using your customer account details.
. Click *Downloads* in the menu bar.
. Click *A-Z* to sort the product downloads alphabetically.
. Click menu:Red Hat CloudForms[Download Latest] to access the product download page.
. From the list of installers and images, click the *Download Now* link for the latest version of the *CFME Red Hat Virtual Appliance (qcow)*.
endif::cfme[]

After the image completes downloading, you are ready to upload the {product-title_short} appliance to your Red Hat Virtualization environment and create a virtual machine.

[[uploading-the-appliance-on-red-hat-virtualization]]
=== Uploading the Appliance to Red Hat Virtualization

The method for uploading the {product-title_short} appliance differs depending on the Red Hat Virtualization version you are using.

In Red Hat Virtualization 4.0 and newer, upload the `QCOW2` appliance image using the Red Hat Virtualization Administration Portal.

In Red Hat Enterprise Virtualization 3.6 and earlier, upload the `OVA` appliance image using the image uploader tool. You can also use this method for Red Hat Virtualization 4.0 systems.

Uploading the {product-title} appliance file to Red Hat Virtualization requires:

* 44 GB of storage space on both the export domain and the local partition where `/tmp` resides, as the `OVF` archive is locally expanded into that directory.
* 12 GB RAM.
* 4 vCPUs.

.Prerequisites:

* You must configure the Image I/O Proxy when running `engine-setup`. See https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html/installation_guide/configuring_the_red_hat_virtualization_manager[Configuring the Red Hat Virtualization Manager] in the _Red Hat Virtualization Installation Guide_ for more information.
* Internet Explorer 10, Firefox 35, or Chrome 13 or greater is required to perform this upload procedure. Previous browser versions do not support the required HTML5 APIs.
* You must import the required certificate authority into the web browser used to access the Administration Portal.

[NOTE]
====
To import the certificate authority, browse to `https://<engine_address>/ovirt-engine/services/pki-resource?resource=ca-certificate&format=X509-PEM-CA` and select all the trust settings. Refer to the instructions to install the certificate authority in https://access.redhat.com/solutions/95103[Firefox], https://access.redhat.com/solutions/17864[Internet Explorer], or https://access.redhat.com/solutions/1168383[Google Chrome].
====

[[uploading-the-appliance-using-the-admin-portal]]
==== Uploading the Appliance Using the Administration Portal (RHV 4.x)

In Red Hat Virtualization 4.0 and newer, upload the `QCOW2` appliance image using the Red Hat Virtualization Administration Portal.
After uploading the image, create a disk and attach it to a virtual machine.

To upload the appliance::

. Log in to the Red Hat Virtualization Administration Portal.
. Click menu:Storage[Disks].
. Select menu:Upload[Start].
. Click *Choose File*, and select the appliance image to upload.
. Under *Disk Options*, enter an *Alias* for the image.
. (Optional) Edit other fields in *Disk Options* if desired.
. Click *OK*.

A progress bar in the *Status* column indicates the status of the upload. You can also pause, cancel, or resume uploads from the *Upload* menu. The status shows *OK* when the image has completed uploading.

[NOTE]
====
Ensure your Red Hat Enterprise Virtualization Manager has administrator access to the chosen export storage domain.
See the https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html/administration_guide/sect-storage_tasks#Uploading_Images_to_a_Data_Storage_Domain[Uploading Images to a Data Storage Domain] in the _Red Hat Virtualization Administration Guide_ for more information.
====

.Increasing the Upload Timeout Value

. If the upload times out and you see the message, `Reason: timeout due to transfer inactivity`, increase the timeout value:
+
----
# engine-config -s TransferImageClientInactivityTimeoutInSeconds=6000
----
+
. Restart the ovirt-engine service:
+
----
# systemctl restart ovirt-engine
----


[[creating_vm-RHV4]]
===== Creating a {product-title_short} Virtual Machine in Red Hat Virtualization 4.x

After uploading the appliance to the data domain, create a virtual machine containing the {product-title_short} image and a second disk for the database:

. In menu:Compute[Virtual Machines], click *New* to open the *New Virtual Machine* dialog.
. From the *General* tab, specify a name for the virtual machine and any other details.
. Click *Attach*.
. Select the {product-title_short} appliance you uploaded from the list of images and click *OK*.
. Click the VM to open its details screen, and click the *Disks* tab.
. Click *Edit* to the disk, and check *Bootable* if it is not marked already.
. Click *OK*.
. Add a second disk for the database:
.. Click the *General* tab and click the *Edit* button to edit the virtual machine.
.. Click *+* and *Create* to create a disk for the database (VMDB).
.. Specify a *Size* in GB for the disk that allows sufficient space for your database. Red Hat recommends allocating the virtual machine disk fully at the time of creation. Three main factors affect the size of your database over time:
+
* Virtual Machine Count: the most important factor in the calculation of virtual machine database (VMDB) size over time.
* Host Count: the number of hosts associated with the provider.
* Storage Count: the number of individual storage elements as seen from the perspective of the provider or host. It is not the total number of virtual disks for all virtual machines.
+
ifdef::cfme[]
[NOTE]
====
See https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.5/html-single/deployment_planning_guide/#database-requirements[Database Requirements] in the _Deployment Planning Guide_ for information on calculating disk size for your database.
====
endif::cfme[]
ifdef::miq[]
[NOTE]
====
See "Database Requirements" in the _Deployment Planning Guide_ for size considerations.
====
endif::miq[]
+
.. Set the *Allocation Policy* to `Preallocated` (thick provisioning) for best performance.
.. Specify any other values as desired.
. Click *OK* to create the disk and return to the *New Virtual Machine* window.
. Add a network interface to the virtual machine by selecting a vNIC profile from the *nic1* list.
. Click *OK* to save your changes to the virtual machine.
. Start the {product-title_short} appliance by clicking the *Run* button.

Your Red Hat Virtualization environment now contains a running {product-title_short} appliance.


[[uploading-the-appliance-with-the-image-uploader]]
==== Uploading the Appliance with the Image Uploader (RHEV 3.x)

In Red Hat Enterprise Virtualization 3.6 and earlier, upload the appliance as an `OVA` image using the image uploader tool. Red Hat Virtualization 4.0 supports this method as well.

Refer to
https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.1-beta/html-single/administration_guide/#sect-The_Image_Uploader_Tool[The Image Uploader Tool] in the _Red Hat Virtualization Administration Guide_ for more details on using the image uploader.

To install the image uploader, install the `rhevm-image-uploader` package containing the `engine-image-uploader` script to your local machine:

----
# yum install rhevm-image-uploader
----


Upload the {product-title} appliance using the image uploader:

. Change to the directory containing the {product-title} appliance.
. Run the following command:
+
----
# engine-image-uploader -N `newimagename` -e `myexportdomain` -v -m upload cfme-rhevm-5.3-15.x86_64.rhevm.ova
----
+
Substitute `newimagename` with your chosen name for the image, and substitute `myexportdomain` with your chosen export storage domain.
+
====
[NOTE]
It is recommended to use `-v` (verbose logging) when using the `engine-image-uploader` script to see the progression of the upload.
====
+
. Enter the password of the default administrative user for your Red Hat Enterprise Virtualization Manager when prompted.
+
----
Please provide the REST API password for the admin@internal oVirt Engine user (CTRL+D to abort): **********
----
+

[IMPORTANT]
====
Ensure your Red Hat Enterprise Virtualization Manager has administrator access to the chosen export storage domain.
====

It takes approximately 90 minutes to upload the {product-title} appliance file to the Red Hat Enterprise Virtualization Manager. Once the `OVA` is uploaded and imported as a template, add a network adapter to the template itself.


[[uploading-the-appliance-manually]]
==== Uploading the Appliance Manually (RHEV 3.x)

The following procedure provides manual upload instructions for Red Hat Enterprise Virtualization 3.6 and earlier, if the image uploader tool is not available or fails to upload.

. Log in to a host in your Red Hat Virtualization system with a mount to the export storage domain.
. Change to the export storage domain's directory.
. Copy the {product-title} appliance `OVF` archive to this directory.
. Run the `ls` command to locate the directory named after a GUID, and change to that directory.
. Extract the `OVF` file using the `tar` command, substituting the `.ova` filename with your download. For example:
+
----
[root@localhost 4a8fc2b1-0a57-47fd-b622-7e170981305b]# tar xvf ../cfme-rhevm-5.7.0.17-1.x86_64.rhevm.ova
images/
images/896d49ac-a5e4-4b73-8448-9778bb76ce32/
images/896d49ac-a5e4-4b73-8448-9778bb76ce32/26e85696-78a4-4a82-aedd-bf60a4aa7dae.meta
images/896d49ac-a5e4-4b73-8448-9778bb76ce32/26e85696-78a4-4a82-aedd-bf60a4aa7dae
master/
master/vms/
master/vms/647d5765-17fe-436d-aff1-82243e79976a/
master/vms/647d5765-17fe-436d-aff1-82243e79976a/647d5765-17fe-436d-aff1-82243e79976a.ovf
----
+
. Change ownership of the `images` and `master` export directories so the appliance can be imported as a template:
+
----
[root@localhost 4a8fc2b1-0a57-47fd-b622-7e170981305b]# chown -R 36:36 master/
[root@localhost 4a8fc2b1-0a57-47fd-b622-7e170981305b]# chown -R 36:36 images/
----
+

The Red Hat Virtualization export domain shows the {product-title} appliance in the administration portal.


[[running-rhev3]]
===== Running {product-title} in Red Hat Enterprise Virtualization 3.x

After uploading the appliance to the export storage domain, import it as a template and create a virtual machine. 

. Import the appliance image from the export storage domain as a template in a Red Hat Virtualization data storage domain: 
.. Click the *Storage* tab, then select the export storage domain you uploaded the image to.
.. From the details pane, click the *Template Import* tab, and select the image (`newimagename`) you uploaded.
.. Click *Import*, and specify the *Cluster* and *CPU Profile* as desired.
.. Click *OK*.
+
You can check the import status on the *Events* tab. See https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.1-beta/html-single/virtual_machine_management_guide/#sect-Exporting_and_Importing_Virtual_Machines_and_Templates[Exporting and Importing Virtual Machines and Templates] in the Red Hat Virtualization _Virtual Machine Management Guide_ for additional information.
+
. Check if the template has a network interface (NIC). If the template does not include one, create a NIC for it:
.. From the *Templates* tab, select the template you imported to view its details.
.. From the details pane, click the *Network Interfaces* tab to check if a NIC is listed. If there is an existing NIC, continue to the next step. If no existing NIC is shown:
... Create a NIC by clicking *New* in the *Network Interfaces* tab.  
... In the *New Network Interface* dialog, specify any values as desired or leave the defaults. 
... Click *OK*.
+
The new NIC shows in the *Network Interfaces* tab.
+
. Create a new virtual machine using the {product-title} appliance template as a basis:
.. From the *Templates* tab, select the {product-title_short} template.
.. Click *New VM* to open the *New Virtual Machine* dialog. 
.. Specify a name for the virtual machine, and any other details as desired. 
.. Click *OK*.
+
The virtual machine is created. To view the virtual machine, select the data center, then the *Virtual Machines* tab to view a list of all virtual machines.
. Add a database disk if you are hosting the database on the same machine as the appliance:
//From BZ1411114 - “how big?  Thin or thick provisioned?  (Anything else to consider?)
.. To add a disk, select your virtual machine from the *Virtual Machines* tab.
.. From the details pane, click the *Disks* tab. 
.. Click *New* to open the *New Virtual Disk* dialog.
ifdef::cfme[.. Specify a *Size* in GB for the disk that allows sufficient space for your database. See https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.2/html/deployment_planning_guide/introduction#database-requirements[Database Requirements] in the _Deployment Planning Guide_ for size considerations.]
ifdef::miq[.. Specify a *Size* in GB for the disk that allows sufficient space for your database. See "Database Requirements" in the _Deployment Planning Guide_ for size considerations.]
.. Set the *Allocation Policy* to `Preallocated` (thick provisioning) for best performance.
.. Specify any other values as desired.
.. Click *OK* to create the disk.
. To start the {product-title} appliance, select the virtual machine from the *Virtual Machines* tab and click image:greentriangle.png[] (*Run*). 

Your Red Hat Virtualization environment now contains a running {product-title} appliance.

